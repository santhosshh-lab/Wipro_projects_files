package com.adminservice.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import com.adminservice.dto.UserDto;
import org.springframework.web.client.RestTemplate;
import java.util.Arrays;
import java.util.List;


import com.adminservice.dto.UserDto;
import com.adminservice.entity.Admin;
import com.adminservice.repo.AdminRepository;

@Service
public class AdminService {

    @Autowired
    private AdminRepository repo;
    
    @Autowired
    private RestTemplate restTemplate;

    private final String USER_SERVICE_URL = "http://localhost:8081/users";


    public Admin register(Admin a) {
        return repo.save(a);
    }

    public Admin login(String email, String password) {

        Admin admin = repo.findByEmail(email)
                .orElseThrow(() -> new RuntimeException("Admin email not found"));

        if (!admin.getPassword().equals(password)) {
            throw new RuntimeException("Invalid password");
        }

        return admin;
    }

 // ADMIN → CREATE USER
    public UserDto createUser(UserDto u) {
        return restTemplate.postForObject(USER_SERVICE_URL + "/register", u, UserDto.class);
    }

    // ADMIN → GET ALL USERS
    public List<UserDto> getAllUsers() {
        UserDto[] arr = restTemplate.getForObject(USER_SERVICE_URL, UserDto[].class);
        return Arrays.asList(arr);
    }

    // ADMIN → GET USER BY ID
    public UserDto getUserById(Long id) {
        return restTemplate.getForObject(USER_SERVICE_URL + "/" + id, UserDto.class);
    }

    // ADMIN → UPDATE USER
    public UserDto updateUser(Long id, UserDto u) {
        restTemplate.put(USER_SERVICE_URL + "/" + id, u);
        return u;
    }

    // ADMIN → DELETE USER
    public String deleteUser(Long id) {
        restTemplate.delete(USER_SERVICE_URL + "/" + id);
        return "User deleted successfully";
    }

}
